<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head lang="en">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous" />
    
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <div id="questions">
    <!-- We will put our React component inside this div. -->
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
    integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
    crossorigin="anonymous"></script>

  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>


  <script type="text/babel">

    'use strict';

    class Package {
      constructor(title, price, imgScr, stuff) {
        this.title = title
        this.price = price
        this.imgSrc = imgScr
        this.stuff = stuff
      }
    }

    class Product {
      constructor(title, price, imgScr, discount) {
        this.title = title
        this.price = price
        this.imgSrc = imgScr
        this.discount = discount;
      }
    }

    const product = new Product("tyhjä", 0, null, false)

    // Pyörän varustepaketti 
    const tarakka_tavis = new Product("Tavarateline", 80, null, false)
    const etutakavalo = new Product("Ladattava led etu- ja takavalo", 15, null, false)
    const lukko = new Product("U-lukko", 40, null, false)
    const soittokello_tavis = new Product("Soittokello", 5, null, false)

    // Citypyöräilijän varustepaketti
    const tarakka_city = new Product("Tavarateline", 45, null, false)
    const etuvalo = new Product("Etuvalo", 15, null, false)
    const takavalo = new Product("Takavalo", 14, null, false)
    const soittokello_city = new Product("Soittokello", 7.5, null, false)

    // Pyöränhuoltopaketti
    const tyokalu = new Product("Työkalu", 20, null, false)
    const paikkaussetti = new Product("Paikkaussetti", 5, null, false)
    const ketjuoljy = new Product("Ketjuöljy", 12, null, false)
    const pumppu = new Product("Jalkapumppu mittarilla", 50, null, false)

    // Citypyöräilijän paketti
    const sadeviitta = new Product("Sadeviitta", 40, null, true)
    const kori = new Product("Kori", 75, null, false)
    const kypara_city = new Product("Pyöräilykypärä", 70, null, false)
    const pyoralaukku_city = new Product("City-pyörälaukku", 150, null, true)

    // Pidemmän matkan työmatkapyöräilijän varustepaketti
    const pyoralaukku_pitka = new Product("Pyörän sivulaukut", 90, null, true)
    const kypara_pitka = new Product("Pyöräilykypärä", 60, null, false)
    const polkimet = new Product("Kombipolkimet", 40, null, true)
    const kengat = new Product("Pyöräilykengät", 90, null, true)
    const kynsikkaat = new Product("Pyöräilykynsikkäät", 30, null, false)
    const lasit = new Product("Pyöräilylasit", 30, null, false)

    // Pidemmän matkan työmatkapyöräilijän vaatepaketti
    const takki = new Product("Pyöräilytakki", 100, null, false)
    const housut = new Product("Pyöräilyhousut", 100, null, false)

    // Sadesään paketti
    const hanskat_sade = new Product("Vedenpitävät hanskat", 30, null, false)
    const kenkasuoja_sade = new Product("Kenkien sadesuoja", 25, null, false)
    const satulasuoja = new Product("Satulan sadesuoja", 10, null, false)
    const kyparasuoja = new Product("Kypärän sadesuoja", 15, null, false)
    const sadevaatteet = new Product("Sadetakki ja -housut pyöräilyyn", 100, null, false)

    // Syyssään paketti
    const pipo = new Product("Tuulenpitävä pipo", 20, null, false)
    const hanskat_syys = new Product("Lämpimät hanskat", 50, null, true)
    const heijastinliivi = new Product("Heijastinliivi", 10, null, false)

    // Pakkassään paketti
    const kenkasuoja_talvi = new Product("Lämpimät kengänpäälliset", 50, null, false)
    const hanskat_talvi = new Product("Talvipyöräilyhanskat", 80, null, false)
    const kyparamyssy = new Product("Kypärämyssy", 20, null, false)
    const kerrasto = new Product("Merinovillakerrasto", 80, null, false)
    const nastarenkaat = new Product("Nastarenkaat", 30, null, false)


    // packages
    const varustepaketti = new Package("Pyörän varustepaketti", 140, "images/varustepaketti.png", [tarakka_tavis, etutakavalo, lukko, soittokello_tavis])
    const varustepakettiCity = new Package("Citypyöräilijän varustepaketti", 121.5, "images/varustepakettiCity.png", [tarakka_city, etuvalo, takavalo, lukko, soittokello_city])
    const huoltopaketti = new Package("Pyöränhuoltopaketti", 87, "images/huoltopaketti.png", [tyokalu, paikkaussetti, ketjuoljy, pumppu])
    const citypaketti1 = new Package("Citypyöräilijän paketti korilla", 185, "images/citypaketti1.png", [sadeviitta, kori, kypara_city])
    const citypaketti2 = new Package("Citypyöräilijän paketti sivulaukulla", 260, "images/citypaketti2.png", [sadeviitta, pyoralaukku_city, kypara_city])
    const pitkamatkavaruste = new Package("Pidemmän matkan työmatkapyöräilijän varustepaketti", 340, "images/pidemman_matkan_varustepaketti.PNG", [pyoralaukku_pitka, kypara_pitka, polkimet, kengat, kynsikkaat, lasit])
    const pitkamatkavaate = new Package("Pidemmän matkan työmatkapyöräilijän vaatepaketti", 200, "images/pidemman_matkan_vaatepaketti.PNG", [takki, housut])
    const sadesaa = new Package("Sadesään paketti", 180, "images/sadepaketti.PNG", [hanskat_sade, kenkasuoja_sade, satulasuoja, kyparasuoja, sadevaatteet])
    const syyssaa = new Package("Syyssään paketti", 80, "images/syyssaapaketti.PNG", [pipo, hanskat_syys, heijastinliivi])
    const talvisaa = new Package("Talvisään paketti", 260, "images/talvipyorailypaketti.PNG", [kenkasuoja_talvi, hanskat_talvi, kyparamyssy, kerrasto, nastarenkaat])

    // bikes
    const cheaperHybrid_product = new Product("Edullisempi hybridi", 300, "images/cheaperHybrid.png", true)
    const hybrid_product = new Product("Hybridi", 500, "images/cheaperHybrid.png", true)
    const expensiveHybrid_product = new Product("Hybridi", 900, "images/expensiveHybrid.PNG", true)
    const citybike_product = new Product("City-pyörä", 350, "images/citybike.png", true)
    const cityElectric_product = new Product("City-sähköpyörä", 2100, "images/cityelectric.png", true)

    const cheaperHybrid = new Package("Edullisempi hybridi", 300, "images/cheaperHybrid.png", [cheaperHybrid_product])
    const hybrid = new Package("Hybridi", 500, "images/cheaperHybrid.png", [hybrid_product])
    const expensiveHybrid = new Package("Hybridi", 900, "images/expensiveHybrid.PNG", [expensiveHybrid_product])
    const citybike = new Package("City-pyörä", 350, "images/citybike.png", [citybike_product])
    const cityElectric = new Package("City-sähköpyörä", 2100, "images/cityelectric.png", [cityElectric_product])

    //seats
    const juniorSeat_product = new Product("Junior-istuin", 90, "images/juniorSeat.PNG", true)
    const childCarriage_product = new Product("Lastenkuljetuskärry (1 paikka)", 750, "images/childCarriage.PNG", true)
    const babySeat_product = new Product("Lastenistuin", 100, "images/babySeat.PNG", true)

    const juniorSeat = new Package("Junior-istuin", 90, "images/juniorSeat.PNG", [juniorSeat_product])
    const childCarriage = new Package("Lastenkuljetuskärry (1 paikka)", 750, "images/childCarriage.PNG", [childCarriage_product])
    const babySeat = new Package("Lastenistuin", 100, "images/babySeat.PNG", [babySeat_product])

    const App = (props) => {

      // question data

      const question1 =
      {
        title: "Tarvitsetko uuden pyörän?",

        selections: [
          {
            value: "no_bike",
            text: "En"

          },
          {
            value: "yes_bike",
            text: "Kyllä"

          }
        ]

      }

      const question2 =
      {
        title: "Minkälaisiin sääoloihin etsit pyörää/varusteita?",

        selections: [
          {
            value: "dry",
            text: "Vain kuivalle kelille"

          },
          {
            value: "rainy",
            text: "Myös sateiselle kelille"

          },
          {
            value: "snow",
            text: "Myös lumiselle talvikelille"

          }
        ]
      }

      // optional question! shown if q2 = dry
      const question3 =
      {
        title: "Pyöräiletkö vain lyhyitä kaupunkimatkoja (alle 4 km)?",

        selections: [
          {
            value: "short",
            text: "Kyllä"

          },
          {
            value: "long",
            text: "Ei, myös pidempiä matkoja"
          }
        ]
      }

      const question4 =
      {
        title: "Onko sinulla tarvettaa kuljettaa tavaroita pyörällä?",

        selections: [
          {
            value: "yes_cargo",
            text: "Kyllä"

          },
          {
            value: "no_cargo",
            text: "Ei"
          }
        ]
      }

      const question5 =
      {
        title: "Onko sinulla tarvettaa kuljettaa lapsia pyörällä?",

        selections: [
          {
            value: "yes_child",
            text: "Kyllä"

          },
          {
            value: "no_child",
            text: "Ei"
          }
        ]
      }

      const question6 =
      {
        title: "Hintataso?",

        selections: [
          {
            value: "cheap",
            text: "Edullinen"
          },
          {
            value: "medium",
            text: "Keskitaso"
          },
          {
            value: "expensive",
            text: "Kallis"
          }
        ]
      }



      const answerTree = {
        dry: {
          short: {
            cheap: { packages: [[varustepakettiCity], [huoltopaketti], [citypaketti1]], bike: [citybike] },
            medium: { packages: [[varustepakettiCity], [huoltopaketti], [citypaketti1, citypaketti2]], bike: [cheaperHybrid, hybrid] },
            expensive: { packages: [[varustepakettiCity], [huoltopaketti], [citypaketti2]], bike: [expensiveHybrid, cityElectric] }
          },
          long: {
            cheap: { packages: [[varustepaketti], [huoltopaketti], [pitkamatkavaate], [pitkamatkavaruste]], bike: [cheaperHybrid] },
            medium: { packages: [[varustepaketti], [huoltopaketti], [pitkamatkavaate], [pitkamatkavaruste]], bike: [hybrid, expensiveHybrid, cityElectric] },
            expensive: { packages: [[varustepaketti], [huoltopaketti], [pitkamatkavaate], [pitkamatkavaruste]], bike: [expensiveHybrid, cityElectric] }
          }
        },
        rainy: {
          none: {
            cheap: { packages: [[varustepaketti], [huoltopaketti], [pitkamatkavaate], [pitkamatkavaruste], [syyssaa], [sadesaa]], bike: [cheaperHybrid] },
            medium: { packages: [[varustepaketti], [huoltopaketti], [pitkamatkavaate], [pitkamatkavaruste], [syyssaa], [sadesaa]], bike: [hybrid, expensiveHybrid, cityElectric] },
            expensive: { packages: [[varustepaketti], [huoltopaketti], [pitkamatkavaate], [pitkamatkavaruste], [syyssaa], [sadesaa]], bike: [expensiveHybrid, cityElectric] }
          }
        },
        snow: {
          none: {
            cheap: { packages: [[varustepaketti], [huoltopaketti], [pitkamatkavaate], [pitkamatkavaruste], [syyssaa], [sadesaa], [talvisaa]], bike: [cheaperHybrid] },
            medium: { packages: [[varustepaketti], [huoltopaketti], [pitkamatkavaate], [pitkamatkavaruste], [syyssaa], [sadesaa], [talvisaa]], bike: [hybrid, expensiveHybrid, cityElectric] },
            expensive: { packages: [[varustepaketti], [huoltopaketti], [pitkamatkavaate], [pitkamatkavaruste], [syyssaa], [sadesaa], [talvisaa]], bike: [expensiveHybrid, cityElectric] }
          }
        }
      }



      const [isResultVisible, setIsResultVisible] = React.useState(true)

      const [q1Value, setQ1Value] = React.useState("none") // omistatko polkupyörän
      const [q2Value, setQ2Value] = React.useState("none") // polkupyörän yleinen tyyppi
      const [q3Value, setQ3Value] = React.useState("none") // normaalin pyörän tyyppi
      const [q4Value, setQ4Value] = React.useState("none") // sää
      const [q5Value, setQ5Value] = React.useState("none") // hintaluokka
      const [q6Value, setQ6Value] = React.useState("none") // hintaluokka

      const [total, setTotal] = React.useState(0)
      const [priceMap, setPriceMap] = React.useState({})

      const questionRef = React.createRef()

      const selectionRef = React.createRef()

      const finalSelectionRef = React.createRef()


      const handleQ1Change = (event) => {
        const value = event.target.value
        console.log("Q1", value)
        setQ1Value(value)
      }

      const handleQ2Change = (event) => {
        const value = event.target.value
        console.log("Q2", value)

        if (value == "dry") {
          questionRef.current.show()
        } else {
          setQ3Value("none")
          questionRef.current.hide()

        }
        setQ2Value(value)
      }

      const handleQ3Change = (event) => {
        const value = event.target.value
        console.log("Q3", value)
        setQ3Value(value)
      }

      const handleQ4Change = (event) => {
        const value = event.target.value
        console.log("Q4", value)
        setQ4Value(value)
      }

      const handleQ5Change = (event) => {
        const value = event.target.value
        console.log("Q5", value)
        setQ5Value(value)
      }

      const handleQ6Change = (event) => {
        const value = event.target.value
        console.log("Q6", value)
        setQ6Value(value)

      }

      const handleSubmit = (evt) => {
        evt.preventDefault()
        console.log("Submitted")
        setIsResultVisible(true)
      }


      const updateMap = (key, value) => {
        const map = { ...priceMap, [key]: value }
        console.log(map)
        setPriceMap(map)
        setTotal(calculateSum(map))
      }

      const resetMap = () => {
        setPriceMap({})
        setTotal(calculateSum({}))
      }

      // package selection doneded
      const onReady = () => {
        console.log("ready", priceMap)
        selectionRef.current.hide()
        finalSelectionRef.current.show()
        finalSelectionRef.current.setProductsMap(priceMap)
      }

      const onBackClick = () => {
        selectionRef.current.show()
        finalSelectionRef.current.hide()
        console.log("on back click")
      }

      const onChangeTotalPrice = (total) => {
        setTotal(total)
      }

      return (
        <div>
          <nav className="navbar navbar-light bg-light fixed-top">
            <span className="navbar-brand mb-0">Hinta: {total} € tai {(total / 12).toFixed(2)} €/kk </span>
          </nav>
          <div className="content">
            <Togglable ref={selectionRef} initialVisible={true}>

              <div className="container-fluid">

                <div className="row">
                  <div className="col-lg-6 col-xl-3 col-md-12 col-sm-12">
                    <h2>Työmatkapyöräilijän paketti</h2>
                    <br />
                    <form onSubmit={handleSubmit}>

                      <SelectableRadio items={question1.selections} onChange={handleQ1Change} value={q1Value} id="q1" title={question1.title} />

                      <SelectableRadio items={question2.selections} onChange={handleQ2Change} value={q2Value} id="q2" title={question2.title} />

                      <Togglable ref={questionRef} initialVisible={false}>
                        <SelectableRadio items={question3.selections} onChange={handleQ3Change} value={q3Value} id="q3" title={question3.title} />
                      </Togglable>

                      <SelectableRadio items={question4.selections} onChange={handleQ4Change} value={q4Value} id="q4" title={question4.title} />

                      <SelectableRadio items={question5.selections} onChange={handleQ5Change} value={q5Value} id="q5" title={question5.title} />

                      <SelectableRadio items={question6.selections} onChange={handleQ6Change} value={q6Value} id="q6" title={question6.title} />

                    </form>
                  </div>

                  <div className="col-lg-6 col-xl-9 col-md-12 col-sm-12">
                    <h2>Suosittelemme seuraavia tuotteita</h2>
                    <h3>Valitse haluamasi tuotteet</h3>
                    <hr />
                    <Result isVisible={true} q1={q1Value} q2={q2Value} q3={q3Value} q4={q4Value} q5={q5Value} q6={q6Value} updateMap={updateMap} answerTree={answerTree} resetMap={resetMap} onReady={onReady} />
                  </div>
                </div>
              </div>

            </Togglable>
            <div className="container">

              <FinalSelection ref={finalSelectionRef} onChangeTotalPrice={onChangeTotalPrice} onBackClick={onBackClick} />

            </div>
          </div>
        </div>



      )
    }

    const FinalSelection = React.forwardRef((props, ref) => {

      const [products, setProducts] = React.useState([])
      const [selected, setSelected] = React.useState([])
      const [selectedDiscount, setSelectedDiscount] = React.useState([])

      const toggleRef = React.createRef()

      const toggleVisibility = () => {
        toggleRef.current.toggleVisibility()
      }

      const show = () => {
        toggleRef.current.show()
      }

      const hide = () => {
        toggleRef.current.hide()
      }

      const setProductsMap = (productsMap) => {
        console.log("products!!!", productsMap)

        let packagesArr = []

        Object.keys(productsMap).forEach(key => packagesArr = packagesArr.concat(productsMap[key]))

        let productsArr = []

        packagesArr.forEach(item => productsArr = productsArr.concat(item.stuff))
        setProducts(productsArr)
        setSelected(Array(productsArr.length).fill(true))
        setSelectedDiscount(Array(productsArr.length).fill(false))

        window.scrollTo(0, 0)

      }

      React.useImperativeHandle(ref, () => {
        return {
          toggleVisibility,
          show,
          hide,
          setProductsMap
        }
      })

      const onChange = (id) => {
        const newSelected = [...selected]
        if (newSelected[id]) {
          newSelected[id] = false
        } else {
          newSelected[id] = true
        }
        setSelected(newSelected)
        
        calculatePrice(newSelected, selectedDiscount)


        
      }

      const onChangeDiscount = (id) => {

        const newDiscount = [...selectedDiscount]
        if (newDiscount[id]) {
          newDiscount[id] = false
        } else {
          newDiscount[id] = true
        }
        setSelectedDiscount(newDiscount)
        
        calculatePrice(selected, newDiscount)
      }

      const calculatePrice = (selectedArr, discountArr) => {
        const sum = selectedArr.map((item, index) => {
          if (item) {

            let discountFactor = 1
            if(discountArr[index]) { //if discount selected
              discountFactor = 0.7
            }

            return products[index].price * discountFactor
          } else return 0
        }).reduce((prev, current) => prev + current, 0)

        props.onChangeTotalPrice(sum)
      }

      const productListItems = products.map((item, index) => <ProductItem key={index} id={index} product={item} onChange={onChange} checked={selected[index]} onChangeDiscount={onChangeDiscount}/>)


      return (
        <div>
          <Togglable ref={toggleRef} initialVisible={false}>
            <CustomButton title="Takaisin" handleClick={props.onBackClick} />
            <h3>Tuotteet</h3>
            <div className="container">
              {productListItems}
            </div>
            <CustomButton title="Takaisin" handleClick={props.onBackClick} />

            <div style={{ minHeight: '600px' }}>
              <h2> Valitse toimitustapa jne jne </h2>
              <p> lorem impsum ja sitä rataa </p>
            </div>
          </Togglable>

        </div>
      )
    }
    )

    const ProductItem = ({ id, product, onChange, onChangeDiscount, checked }) => {

      let imageStyle = {}


      const leftMargin = {
        marginLeft: '10px'
      }

      const styleDiscount = {
        backgroundColor: '#fcec03',
        padding: '3px'
      }

      return (
        <div className="row">
          <div className="col-12 cell" style={{ borderStyle: 'solid', marginBottom: '10px' }}>
            <div style={{ marginTop: '5px' }}>
              <h3><input type="checkbox" checked={checked} style={{ marginRight: '10px' }} onChange={() => onChange(id)} /> {product.title}  </h3>
              <p>{product.price} €</p>
              {product.discount ? <p> <input type="checkbox" defaultChecked={false} disabled={!checked} style={{ marginRight: '10px' }} onChange={() => onChangeDiscount(id)} /> Käytetty: <span style={styleDiscount}>-30 %</span></p>  : <div></div>}
              {product.imgSrc != null ? <img src={product.imgSrc} style={{maxHeight:'150px'}}/> : <div></div>}              
            </div>
          </div>
        </div>
      )
    }



    const CustomButton = ({ title, handleClick }) => {

      const style = {
        fontSize: "40px"

      }

      return (<button className="btn btn-primary" style={style} onClick={handleClick}>{title}</button>)
    }

    const SelectableRadio = ({ items, onChange, value, id, title }) => {

      const style = {
        marginTop: '15px'
      }
      const options = items.map((item, index) =>
        <div key={index}>
          {value === item.value ? <input type="radio" name={"radio" + id} id={id + "_" + index} className="radio" value={item.value} onChange={onChange} checked={true} /> :
            <input type="radio" name={"radio" + id} id={id + "_" + index} className="radio" value={item.value} onChange={onChange} checked={false} />
          }
          <label className="customRadioLabel" style={style} htmlFor={id + "_" + index}>{item.text}</label>
        </div>
      )

      return (
        <div className="form-group">
          <div className="customRadioDiv">
            <h3>{title}</h3>
            {options}
          </div>
        </div>
      )

    }

    // onChangeSelected products arg: Array
    const Products = ({ categoryKey, onChangeSelectedProducts, products }) => {


      const [selected, setSelected] = React.useState(Array(products.length).fill(false))


      const handleSelect = (id) => {

        const newSelected = [...selected]

        console.log("bvefore", selected)
        if (newSelected[id] === true) {
          newSelected[id] = false
        } else {
          newSelected[id] = true
        }

        console.log("after", newSelected)
        setSelected(newSelected)


        //set selected products
        const selectedProducts = new Array()

        products.forEach((item, index) => {
          if (newSelected[index]) {
            selectedProducts.push(item)
          }
        })

        onChangeSelectedProducts(categoryKey, selectedProducts)
      }


      const productImages = products.map((item, index) => <ProductImage key={index} title={item.title} src={item.imgSrc} price={item.price} id={index} handleSelect={handleSelect} selected={selected[index]} />)

      return (
        <div>
          <div className="row">
            {productImages}
          </div>
        </div>
      )
    }

    /**
    * Selectable productPackage (image)
    */
    const ProductImage = ({ id, title, src, selected, handleSelect, price }) => {

      const imgStyleSelected = {
        maxHeight: '400px',
        padding: '10px',
        backgroundColor: '#44bcd8',
        margin: '10px 10px 10px 0px'
      };

      const imgStyle = {
        maxHeight: '400px',
        padding: '10px',
        margin: '10px 10px 10px 0px'
      };

      let imageStyle = {}

      if (selected) {
        imageStyle = imgStyleSelected
      } else {
        imageStyle = imgStyle
      }

      const leftMargin = {
        marginLeft: '10px'
      }

      return (
        <div className="product">
          <h3 style={leftMargin}>{title}</h3>
          <h3 style={leftMargin}>{price} €</h3>
          <img onClick={() => handleSelect(id)} src={src} style={imageStyle} />

        </div>
      )
    }


    /**
    * Shows the result
    */
    const Result = ({ isVisible, q1, q2, q3, q4, q5, q6, updateMap, answerTree, resetMap, onReady }) => {

      React.useEffect(() => resetMap, [q1, q2, q3, q4, q5, q6])

      const onChangeSelectedProducts = (categoryKey, selectedProducts) => {
        updateMap(categoryKey, selectedProducts)
        console.log(categoryKey, selectedProducts)
      }

      const isBikeSelected = () => {
        return q1 === 'yes_bike'
      }

      const isChildSelected = () => {
        return q5 === 'yes_child'
      }

      let packs = null

      // ugly hacks to see if all questions are answered.
      try {
        packs = answerTree[q2][q3][q6]
      } catch (error) {
        return (<div>No selection !!!</div>)
      }

      if (packs === null || packs === undefined) {
        return (<div> No selection !!!</div>)
      }

      if (!("bike" in packs && "packages" in packs)) {
        return (<div> No selection !!!</div>)
      }

      const uniqueKey = q1 + q2 + q3 + q4 + q5 + q6 //create unique key so react understands that it's a brand new set of items based on questions

      const prods = packs.packages.map((item, index) => <Products key={uniqueKey + index} categoryKey={index} onChangeSelectedProducts={onChangeSelectedProducts} products={item} />)



      return (

        <div>
          {prods}
          {isBikeSelected() ? <Products key={uniqueKey + "bike"} categoryKey={"bike"} onChangeSelectedProducts={onChangeSelectedProducts} products={packs.bike} /> : <div></div>}
          {isChildSelected() ? <Products key={uniqueKey + "seat"} categoryKey={"seat"} onChangeSelectedProducts={onChangeSelectedProducts} products={[juniorSeat, babySeat]} /> : <div></div>}
          {isChildSelected() ? <Products key={uniqueKey + "carriage"} categoryKey={"carriage"} onChangeSelectedProducts={onChangeSelectedProducts} products={[childCarriage]} /> : <div></div>}
          <br />
          <CustomButton title="Nysvää paketit" handleClick={onReady} />
        </div>

      )
    }



    const calculateSum = (m) => {
      return Object.keys(m).map(key => m[key]).reduce((total, currentProducts) => {

        const currentPrice = currentProducts.reduce((sum, item) => item.price + sum, 0)

        return (total + currentPrice)
      },
        0)
    }


    /**
    * Togglable component to show/hide content
    */
    const Togglable = React.forwardRef((props, ref) => {
      const [visible, setVisible] = React.useState(props.initialVisible)

      const hideWhenVisible = { display: visible ? 'none' : '' }
      const showWhenVisible = { display: visible ? '' : 'none' }

      const toggleVisibility = () => {
        setVisible(!visible)
      }

      const show = () => {
        setVisible(true)
      }

      const hide = () => {
        setVisible(false)
      }

      React.useImperativeHandle(ref, () => {
        return {
          toggleVisibility,
          show,
          hide
        }
      })

      return (

        <div style={showWhenVisible} className="togglableContent">
          {props.children}
        </div>

      )
    })

    //render
    const domContainer = document.querySelector('#questions');
    ReactDOM.render(<App />, domContainer);

  </script>



</body>

</html>